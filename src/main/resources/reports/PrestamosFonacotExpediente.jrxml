<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.20.0.final using JasperReports Library version 6.20.0-2bc7ab61c56f459e8176eb05c7705e145cd400ad  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="PrestamosFonacotExpediente" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="ec3d5dd6-8bb8-4a0d-9be0-59c19397e594">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="SIRH_DB"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<parameter name="Img" class="java.lang.String"/>
	<parameter name="expediente" class="java.lang.String"/>
	<parameter name="imgNomina" class="java.lang.String"/>
	<parameter name="periodo" class="java.lang.Integer"/>
	<queryString>
		<![CDATA[SELECT
    CONCAT_WS(
        '                 ', 
        cpc.id_cuentas_cobrar,
        TO_CHAR(cpc.fecha_movimiento, 'dd/mm/YYYY'), 
        CONCAT('$', ROUND(cpc.saldo_inicial::numeric, 1)), -- Redondea saldo_inicial
        CONCAT('$', ROUND(cpc.monto_pago::numeric, 1)),   -- Redondea monto_pago
        cpc.numero_deuda,
        cpc.numero_periodos_pago
    ) AS cuentas,
    a_c.periodo,
    CONCAT('$', a_c.abono) as abono,
    CONCAT('$', a_c.saldo_actual) as saldo_actual,
    a_c.estatus,
    c_e.numero_expediente,
    c_t_n.desc_nomina,
    CONCAT(per.apellido_materno, ' ', per.apellido_paterno, ' ', per.nombre) AS nombre,
    (SELECT COUNT(DISTINCT cpc2.id_cuentas_cobrar) 
     FROM fonacot_cuentas_por_cobrar cpc2
     JOIN trabajador tr2 ON tr2.id_trabajador = cpc2.trabajador_id
     JOIN catalogo_expedientes c_e2 ON c_e2.id_expediente = tr2.expediente_id
     WHERE c_e2.numero_expediente =  $P{expediente}) AS cantidad_cuentas_diferentes
FROM fonacot_cuentas_por_cobrar cpc
JOIN fonacot_actualizacion_cuentas a_c ON a_c.cuenta_por_cobrar_id = cpc.id_cuentas_cobrar
JOIN trabajador tr ON tr.id_trabajador = cpc.trabajador_id
JOIN persona per ON per.id_persona = tr.persona_id
JOIN catalogo_tipo_nomina c_t_n ON c_t_n.id_tipo_nomina = cpc.nomina_id
JOIN catalogo_expedientes c_e ON c_e.id_expediente = tr.expediente_id
WHERE c_e.numero_expediente = $P{expediente} and a_c.periodo >=  $P{periodo}
ORDER BY a_c.id_actualizacion_cuentas ASC]]>
	</queryString>
	<field name="cuentas" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="cuentas"/>
		<property name="com.jaspersoft.studio.field.label" value="cuentas"/>
	</field>
	<field name="periodo" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="periodo"/>
		<property name="com.jaspersoft.studio.field.label" value="periodo"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="fonacot_actualizacion_cuentas"/>
	</field>
	<field name="abono" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="abono"/>
		<property name="com.jaspersoft.studio.field.label" value="abono"/>
	</field>
	<field name="saldo_actual" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="saldo_actual"/>
		<property name="com.jaspersoft.studio.field.label" value="saldo_actual"/>
	</field>
	<field name="estatus" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="estatus"/>
		<property name="com.jaspersoft.studio.field.label" value="estatus"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="fonacot_actualizacion_cuentas"/>
	</field>
	<field name="numero_expediente" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="numero_expediente"/>
		<property name="com.jaspersoft.studio.field.label" value="numero_expediente"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="catalogo_expedientes"/>
	</field>
	<field name="desc_nomina" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="desc_nomina"/>
		<property name="com.jaspersoft.studio.field.label" value="desc_nomina"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="catalogo_tipo_nomina"/>
	</field>
	<field name="nombre" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="nombre"/>
		<property name="com.jaspersoft.studio.field.label" value="nombre"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="persona"/>
	</field>
	<field name="cantidad_cuentas_diferentes" class="java.lang.Long">
		<property name="com.jaspersoft.studio.field.name" value="cantidad_cuentas_diferentes"/>
		<property name="com.jaspersoft.studio.field.label" value="cantidad_cuentas_diferentes"/>
	</field>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="110" splitType="Stretch">
			<staticText>
				<reportElement x="133" y="56" width="314" height="16" uuid="17bdcabe-9a90-419d-b2d1-576191ed7783"/>
				<textElement>
					<font size="9"/>
				</textElement>
				<text><![CDATA[REPORTE ANALITICO DE PRESTAMOS FONACOT POR EXPEDIENTE]]></text>
			</staticText>
			<staticText>
				<reportElement x="-8" y="78" width="36" height="24" uuid="1524cbe4-9476-46f9-894e-84db6e7c1843"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<text><![CDATA[ID. CUENTA]]></text>
			</staticText>
			<staticText>
				<reportElement x="44" y="79" width="42" height="24" uuid="008246d1-9d03-45de-8a9d-a14fbc94bd23"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<text><![CDATA[FECHA CAPTURA]]></text>
			</staticText>
			<staticText>
				<reportElement x="105" y="78" width="50" height="24" uuid="433470e6-a7cc-4943-9f43-f0329965cc85"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<text><![CDATA[MONTO PRESTAMO]]></text>
			</staticText>
			<staticText>
				<reportElement x="166" y="78" width="58" height="24" uuid="7bda9619-a5e1-439c-89f3-745ef4a71a18"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<text><![CDATA[MONTO DESCUENTO]]></text>
			</staticText>
			<staticText>
				<reportElement x="237" y="80" width="30" height="22" uuid="7eae4d07-2975-44df-9e21-0dbdf27352d6"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<text><![CDATA[No. DEUDA]]></text>
			</staticText>
			<staticText>
				<reportElement x="285" y="82" width="32" height="20" uuid="bb517ae4-3406-45e9-b2a4-4f463d1df66b"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<text><![CDATA[PLAZO]]></text>
			</staticText>
			<staticText>
				<reportElement x="332" y="80" width="50" height="22" uuid="57180783-0016-4fed-86bc-9b228a1918a0"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<text><![CDATA[PERIODO APLICACION]]></text>
			</staticText>
			<staticText>
				<reportElement x="398" y="82" width="38" height="20" uuid="86f2d73f-7f23-4151-bc2b-24d2cbf90487"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<text><![CDATA[ABONO]]></text>
			</staticText>
			<staticText>
				<reportElement x="456" y="82" width="30" height="20" uuid="9d3340e4-679d-44e1-a1c8-9e9df10cae02"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<text><![CDATA[SALDO]]></text>
			</staticText>
			<staticText>
				<reportElement x="500" y="82" width="40" height="20" uuid="da5a8ce8-0c8d-4fb6-8f5e-32f63e8f1da8"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<text><![CDATA[ESTADO]]></text>
			</staticText>
			<textField pattern="MMMMM dd, yyyy">
				<reportElement x="497" y="57" width="60" height="14" uuid="9c54237f-826c-42d3-84bd-1de6fe012bc0"/>
				<textElement>
					<font size="6"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<image>
				<reportElement x="0" y="0" width="200" height="50" uuid="a8e83e47-119a-405d-81d7-fb16c7d85f0a"/>
				<imageExpression><![CDATA[$P{Img}]]></imageExpression>
			</image>
			<image>
				<reportElement x="360" y="0" width="195" height="50" uuid="2509153f-dcae-4d06-b988-4379cb1381a5"/>
				<imageExpression><![CDATA[$P{imgNomina}]]></imageExpression>
			</image>
		</band>
	</title>
	<pageHeader>
		<band height="35" splitType="Stretch">
			<line>
				<reportElement positionType="FixRelativeToBottom" x="1" y="26" width="559" height="1" uuid="9030fc36-38a9-4d41-aa9e-867717d443a4">
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
			<staticText>
				<reportElement x="34" y="0" width="36" height="16" uuid="15b58bd9-ebe5-4b4d-b225-912d424a902e"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<text><![CDATA[NOMINA:]]></text>
			</staticText>
			<textField>
				<reportElement x="1" y="15" width="34" height="14" uuid="ec183c65-20ee-4b70-8fa4-c501bfc786b5"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{expediente}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="80" y="0" width="86" height="16" uuid="512f475a-5db9-44a5-a609-621a49f49a1e"/>
				<textElement>
					<font isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{desc_nomina}.toUpperCase()]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="34" y="15" width="136" height="20" uuid="e904702c-92e8-4acf-99c7-64035be2f7be"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nombre}.toUpperCase()]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField>
				<reportElement stretchType="RelativeToBandHeight" x="346" y="-7" width="42" height="16" uuid="a21d740a-369b-4b47-9e0c-4d6bdc543948">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="19fd7e21-d5dc-4609-9fab-dcca80e707d1"/>
				</reportElement>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{periodo}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" isPrintRepeatedValues="false" x="478" y="-8" width="95" height="14" uuid="9a8448ed-07f5-4b4e-8b2f-9ec719e91063">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="906c03f1-41d2-4bc6-8e0e-6001e4fb108f"/>
				</reportElement>
				<textElement>
					<font size="7" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{estatus} == 3 ? "CUENTA SALDADA" : ""]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement isPrintRepeatedValues="false" x="0" y="-6" width="320" height="16" uuid="ede050d7-4c11-4a9c-867e-c9217c0e09df">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="02078ad6-adb3-4efe-bfc7-2f1f6533e5c8"/>
				</reportElement>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cuentas}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="411" y="-8" width="40" height="14" uuid="19331efc-1d4b-4cbb-a3be-2d51d797f722"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{abono}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="456" y="-8" width="30" height="12" uuid="17e6cdc2-ffeb-437b-9c9d-a6dec7331368"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{saldo_actual}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="73">
			<staticText>
				<reportElement x="130" y="12" width="90" height="20" uuid="b95cf0e5-7d04-40a4-abef-4d9a014ab4a5"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<text><![CDATA[Total Trabajadores:]]></text>
			</staticText>
			<staticText>
				<reportElement x="130" y="43" width="116" height="20" uuid="df2a9577-aa57-46bb-b26f-78007692dafc"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<text><![CDATA[Tot. Gral. Trabajadores:]]></text>
			</staticText>
			<staticText>
				<reportElement x="285" y="13" width="90" height="20" uuid="5c3abdc8-029b-4e32-9388-50471afa6a45"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<text><![CDATA[Total Prestamos:]]></text>
			</staticText>
			<staticText>
				<reportElement x="285" y="43" width="116" height="20" uuid="f7023430-0f77-4375-8498-d0b89da2d033"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<text><![CDATA[Tot. Gral. Prestamos:]]></text>
			</staticText>
			<staticText>
				<reportElement x="235" y="12" width="34" height="14" uuid="ed0a96c9-06eb-4dc2-93ad-d1f5d4e0c418"/>
				<textElement textAlignment="Center">
					<font size="8"/>
				</textElement>
				<text><![CDATA[1]]></text>
			</staticText>
			<staticText>
				<reportElement x="235" y="43" width="34" height="16" uuid="8ca3e3b0-0d6d-402d-997c-1d1ac5188a74"/>
				<textElement textAlignment="Center">
					<font size="8"/>
				</textElement>
				<text><![CDATA[1]]></text>
			</staticText>
			<textField>
				<reportElement x="400" y="12" width="30" height="20" uuid="0119816b-86a8-48b0-96c9-0c5f9583a0fb"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cantidad_cuentas_diferentes}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="399" y="42" width="30" height="16" uuid="40b7fece-909b-448b-84bc-ab78233417be"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cantidad_cuentas_diferentes}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement stretchType="RelativeToBandHeight" isPrintRepeatedValues="false" x="393" y="-1" width="172" height="16" uuid="04fff692-4b10-452e-ba8b-1b9bf7c2bb5d">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="906c03f1-41d2-4bc6-8e0e-6001e4fb108f"/>
				</reportElement>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{estatus} == 1 ? "Saldo Pendiente: " + $F{saldo_actual} + " CUENTA ACTIVA" : ""]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
