<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.20.0.final using JasperReports Library version 6.20.0-2bc7ab61c56f459e8176eb05c7705e145cd400ad  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="DiferentesBancosExcel" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="cfc90622-ff72-471f-917f-9464637193fe">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="SIRH_DB"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<parameter name="cdmx" class="java.lang.String"/>
	<parameter name="leyenda" class="java.lang.String"/>
	<parameter name="nomina" class="java.lang.String"/>
	<parameter name="periodo" class="java.lang.Integer"/>
	<parameter name="id_nomina" class="java.lang.Integer"/>
	<queryString>
		<![CDATA[WITH CTE_ConteoRegistros AS (
  SELECT COUNT(*) AS total_registros
  FROM personal_cuentas_por_cobrar pcpc
  JOIN trabajador tr ON tr.id_trabajador = pcpc.trabajador_id
  JOIN catalogo_expedientes c_e ON c_e.id_expediente = tr.expediente_id
  JOIN cuenta_bancaria c_b ON c_b.trabajador_id = tr.id_trabajador
  JOIN catalogo_bancos c_ban ON c_ban.id_banco = c_b.banco_id
  JOIN catalogo_tipo_nomina c_t_n ON c_t_n.id_tipo_nomina = pcpc.nomina_id
  WHERE c_t_n.desc_nomina = $P{nomina} AND pcpc.periodo_pago_actual >= $P{periodo} AND pcpc.estatus = 1 AND c_ban.id_banco != 1 GROUP BY c_e.numero_expediente limit 1
),
CTE_SumaSaldoInicial AS (
  SELECT SUM(pcpc.saldo_inicial) AS suma_saldo_inicial_total
  FROM personal_cuentas_por_cobrar pcpc
  JOIN catalogo_tipo_nomina c_t_n ON c_t_n.id_tipo_nomina = pcpc.nomina_id
  JOIN trabajador tr ON tr.id_trabajador = pcpc.trabajador_id
  JOIN cuenta_bancaria c_b ON c_b.trabajador_id = tr.id_trabajador
  JOIN catalogo_bancos c_ban ON c_ban.id_banco = c_b.banco_id
  WHERE c_t_n.desc_nomina = $P{nomina} AND pcpc.periodo_pago_actual >=$P{periodo} AND pcpc.estatus = 1 AND c_ban.id_banco != 1
),
CTE_fechas_periodo AS (
  SELECT 
  p_p.fecha_inicial,
  p_p.fecha_final
  FROM personal_cuentas_por_cobrar pcpc
  JOIN periodos_pago p_p ON p_p.periodo = pcpc.periodo_inicial
  JOIN catalogo_tipo_nomina c_t_n ON c_t_n.id_tipo_nomina = pcpc.nomina_id
  WHERE p_p.pagado=0 AND p_p.especial=0 AND p_p.id_nomina=$P{id_nomina} AND pcpc.estatus = 1 ORDER BY p_p.fecha_inicial ASC Limit 1
)
SELECT 
  CONCAT(pe.apellido_paterno, ' ', pe.apellido_materno, ' ', pe.nombre) AS nombre,
  c_e.numero_expediente,
  pcpc.saldo_inicial,
  pcpc.monto_pago,
  c_ban.id_banco,
  c_b.cuenta_bancaria,
  CTE_ConteoRegistros.total_registros AS cantidad_registros,
  CTE_SumaSaldoInicial.suma_saldo_inicial_total,
  CTE_fechas_periodo.fecha_inicial,
  CTE_fechas_periodo.fecha_final
FROM personal_cuentas_por_cobrar pcpc
JOIN trabajador tr ON tr.id_trabajador = pcpc.trabajador_id
JOIN persona pe ON pe.id_persona = tr.persona_id
JOIN catalogo_expedientes c_e ON c_e.id_expediente = tr.expediente_id
JOIN cuenta_bancaria c_b ON c_b.trabajador_id = tr.id_trabajador
JOIN catalogo_bancos c_ban ON c_ban.id_banco = c_b.banco_id
JOIN catalogo_tipo_nomina c_t_n ON c_t_n.id_tipo_nomina = pcpc.nomina_id
CROSS JOIN CTE_ConteoRegistros
CROSS JOIN CTE_SumaSaldoInicial
CROSS JOIN CTE_fechas_periodo
WHERE c_t_n.desc_nomina = $P{nomina} AND pcpc.periodo_pago_actual >= $P{periodo} AND pcpc.estatus = 1 AND pcpc.deposito = 0 AND c_ban.id_banco != 1]]>
	</queryString>
	<field name="nombre" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="nombre"/>
		<property name="com.jaspersoft.studio.field.label" value="nombre"/>
	</field>
	<field name="numero_expediente" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="numero_expediente"/>
		<property name="com.jaspersoft.studio.field.label" value="numero_expediente"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="catalogo_expedientes"/>
	</field>
	<field name="saldo_inicial" class="java.lang.Double">
		<property name="com.jaspersoft.studio.field.name" value="saldo_inicial"/>
		<property name="com.jaspersoft.studio.field.label" value="saldo_inicial"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="personal_cuentas_por_cobrar"/>
	</field>
	<field name="monto_pago" class="java.lang.Double">
		<property name="com.jaspersoft.studio.field.name" value="monto_pago"/>
		<property name="com.jaspersoft.studio.field.label" value="monto_pago"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="personal_cuentas_por_cobrar"/>
	</field>
	<field name="id_banco" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="id_banco"/>
		<property name="com.jaspersoft.studio.field.label" value="id_banco"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="catalogo_bancos"/>
	</field>
	<field name="cuenta_bancaria" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="cuenta_bancaria"/>
		<property name="com.jaspersoft.studio.field.label" value="cuenta_bancaria"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="cuenta_bancaria"/>
	</field>
	<field name="cantidad_registros" class="java.lang.Long">
		<property name="com.jaspersoft.studio.field.name" value="cantidad_registros"/>
		<property name="com.jaspersoft.studio.field.label" value="cantidad_registros"/>
	</field>
	<field name="suma_saldo_inicial_total" class="java.lang.Double">
		<property name="com.jaspersoft.studio.field.name" value="suma_saldo_inicial_total"/>
		<property name="com.jaspersoft.studio.field.label" value="suma_saldo_inicial_total"/>
	</field>
	<field name="fecha_inicial" class="java.sql.Timestamp">
		<property name="com.jaspersoft.studio.field.name" value="fecha_inicial"/>
		<property name="com.jaspersoft.studio.field.label" value="fecha_inicial"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="periodos_pago"/>
	</field>
	<field name="fecha_final" class="java.sql.Timestamp">
		<property name="com.jaspersoft.studio.field.name" value="fecha_final"/>
		<property name="com.jaspersoft.studio.field.label" value="fecha_final"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="periodos_pago"/>
	</field>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="79" splitType="Stretch">
			<image>
				<reportElement x="0" y="3" width="230" height="70" uuid="2834ffcc-1b4d-4665-9b27-e56f58ea51cf"/>
				<imageExpression><![CDATA[$P{cdmx}]]></imageExpression>
			</image>
			<image>
				<reportElement x="536" y="2" width="264" height="50" uuid="bfe5e855-f85a-41e5-b88f-a4e3bc30a51b"/>
				<imageExpression><![CDATA[$P{leyenda}]]></imageExpression>
			</image>
		</band>
	</title>
	<pageHeader>
		<band height="86" splitType="Stretch">
			<staticText>
				<reportElement x="140" y="0" width="468" height="16" uuid="ecb10aa5-2a47-415b-af78-b37a3ffed558"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[DEPÓSITO A DIFERENTES BANCOS POR CONCEPTO DE PRÉSTAMOS PERSONALES]]></text>
			</staticText>
			<textField pattern="MMMM d, yyyy">
				<reportElement x="650" y="0" width="150" height="16" uuid="cb4300b6-eee5-434a-89a0-abb7bc9c0bfb"/>
				<textElement textAlignment="Center">
					<font size="8"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="14" y="33" width="26" height="14" uuid="24bce813-ddc0-4935-b176-fd07aa290dee"/>
				<text><![CDATA[Del:]]></text>
			</staticText>
			<line>
				<reportElement x="14" y="50" width="250" height="1" uuid="32d2a376-7d06-486b-a32b-27cfc14db42e">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
			<line>
				<reportElement x="15" y="73" width="250" height="1" uuid="4d448811-ee96-4910-bd68-2ab763aafd04">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
			<staticText>
				<reportElement x="14" y="54" width="58" height="14" uuid="05d29354-2de1-4c07-b31a-4383eef3c1a3"/>
				<text><![CDATA[Periodo: ]]></text>
			</staticText>
			<textField>
				<reportElement x="72" y="54" width="68" height="16" uuid="6bc69207-5358-4e7d-a9dd-d8c604f0e3e0"/>
				<textFieldExpression><![CDATA[$P{periodo}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="140" y="54" width="53" height="14" uuid="5447abe0-9102-470a-9d79-779e7d0ddd94"/>
				<text><![CDATA[Nómina:]]></text>
			</staticText>
			<textField>
				<reportElement x="200" y="54" width="62" height="16" uuid="b43f8fc9-270b-4126-be7b-e181248a471f"/>
				<textFieldExpression><![CDATA[$P{nomina}.toUpperCase()]]></textFieldExpression>
			</textField>
			<textField pattern="dd/MMM/yy">
				<reportElement x="45" y="33" width="85" height="15" uuid="267a0a11-c9eb-4f76-b0bf-aaa8a7c892a7"/>
				<textFieldExpression><![CDATA[$F{fecha_inicial}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="133" y="33" width="17" height="14" uuid="e0015bda-8788-4fd5-90a6-e2f852ebf077"/>
				<text><![CDATA[al:]]></text>
			</staticText>
			<textField pattern="dd/MMM/yy">
				<reportElement x="160" y="33" width="78" height="15" uuid="e3feac2a-4b33-47be-b9b1-58bd456316bc"/>
				<textFieldExpression><![CDATA[$F{fecha_final}]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="40" splitType="Stretch">
			<staticText>
				<reportElement x="8" y="8" width="70" height="16" uuid="00eb5bf5-3b85-4d56-9477-c1313fe5e23d"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Expediente]]></text>
			</staticText>
			<staticText>
				<reportElement x="105" y="8" width="62" height="16" uuid="3d57a0ec-9cfb-4893-a1ff-c4f4585318a7"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Nombre]]></text>
			</staticText>
			<staticText>
				<reportElement x="339" y="8" width="51" height="16" uuid="993a4ef7-a645-4b6d-afb9-b7f6b705e7f8"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Importe]]></text>
			</staticText>
			<staticText>
				<reportElement x="400" y="8" width="65" height="16" uuid="04ad18fd-105b-4283-af91-57dff90b80dd"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Descuento]]></text>
			</staticText>
			<staticText>
				<reportElement x="477" y="8" width="97" height="26" uuid="248991d3-d1df-4a50-a276-7a230f526150"/>
				<textElement textAlignment="Center">
					<font size="9" isBold="true"/>
				</textElement>
				<text><![CDATA[No. de Banco Receptor]]></text>
			</staticText>
			<staticText>
				<reportElement x="586" y="8" width="96" height="17" uuid="9556dcfc-4af4-4a89-8b0f-8f83ef4ba2ac"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Tipo de Cuenta]]></text>
			</staticText>
			<staticText>
				<reportElement x="699" y="8" width="86" height="16" uuid="ebc81257-d12b-4af0-ba30-d28c7ca4e48e"/>
				<textElement textAlignment="Center">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Cuenta Clabe]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="61" splitType="Stretch">
			<staticText>
				<reportElement x="610" y="3" width="50" height="14" uuid="bc59a0c8-a12b-4cde-8df2-60d05c78ff2d"/>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<text><![CDATA[Debito]]></text>
			</staticText>
			<textField>
				<reportElement x="12" y="3" width="60" height="14" uuid="8ef18759-6cb6-4c22-a8a6-4e2da45fe4ed">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="0295c0bf-1e6e-4f4e-aec4-c01517da163d"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{numero_expediente}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="107" y="3" width="170" height="14" uuid="3203e207-27eb-431f-b21b-28005c764169">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="25dfc227-1b84-41db-8c51-d48e1e2ebfe0"/>
				</reportElement>
				<textElement textAlignment="Left">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nombre}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="345" y="3" width="38" height="14" uuid="95385feb-2725-4316-9ada-ea41a6da943c">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="5fe2d98f-091e-4230-addf-7d58b627144d"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{saldo_inicial}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="414" y="3" width="42" height="14" uuid="f5a129fd-5b27-4228-81a7-206803d5155d">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="3111a7b4-4c2d-492e-8bc4-aa5b8f2a49f1"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{monto_pago}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="499" y="3" width="51" height="15" uuid="e460826e-47ce-4300-8cfc-bb977f795369">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="eee43c5c-f3cd-43d8-a1ad-9d3537278b46"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{id_banco}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="693" y="3" width="109" height="16" uuid="9be20778-85f4-4a13-a36e-76ba67c1af0e">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="a1913416-216f-4fc4-9972-62ea1c55eed5"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cuenta_bancaria}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="73">
			<staticText>
				<reportElement x="20" y="33" width="150" height="15" uuid="7fbcb5f3-73ad-4f40-9422-4e0366090419"/>
				<textElement>
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTAL DE PERSONAL:]]></text>
			</staticText>
			<textField>
				<reportElement x="178" y="33" width="30" height="13" uuid="ba06f323-62ba-4101-bd61-982d55830548"/>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{cantidad_registros}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="288" y="33" width="53" height="15" uuid="e3718865-958c-438e-8a70-56b3715c676d"/>
				<textElement>
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[TOTAL:]]></text>
			</staticText>
			<textField>
				<reportElement x="343" y="33" width="44" height="15" uuid="19e291b5-f6c3-4ecf-8248-d0d7b8084b57"/>
				<textElement textAlignment="Center">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{suma_saldo_inicial_total}]]></textFieldExpression>
			</textField>
			<line>
				<reportElement x="8" y="10" width="375" height="1" uuid="2b01691a-57fa-4711-a182-d58ffcc750bc">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
			</line>
		</band>
	</pageFooter>
</jasperReport>
